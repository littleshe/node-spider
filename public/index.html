<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>贴吧分析</title>
<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
<style>
	.result,.loading{display:none}
	.thread_list,.reply_list{max-height:300px;overflow:auto}
	.result a em{color:red}
</style>
</head>

<body style="margin:20px">
<div class="container-fluid" style="max-width:600px">
<form>
  <div class="form-group">
	<label>贴吧名称</label>
    <input type="text" name="name" class="form-control" required value="csgo">
  </div>
  <div class="form-group">
	<label>关键词</label>
    <input type="text" name="kw" class="form-control" required value="完美世界">
  </div>
  <div class="form-group">
	<label>时间限制</label>
    <input type="date" name="date" class="form-control">
  </div>
  <div class="form-group">
    <label><input type="checkbox" name="only_thread" checked>只查找主题帖标题</label>
  </div>
  <button type="submit" class="btn btn-default" id="search">Submit</button>
  <span class="loading">正在处理中。。。</span>
</form>
<div class="result">
    <h3>结果显示：</h3>
    <p>主题帖数量：<b class="tn"></b> ， 带有关键字的主题帖数量：<b class="tn1"></b></p>
    <p>回帖数量：<b class="rn"></b></p>
    <h4>所有主题帖：</h4>
    <ol class="thread_list"></ol>
    <h4>所有回帖：</h4>
    <ol class="reply_list"></ol>
</div>
<script src="/js/jquery.js"></script>
<script>
$(function(){
	
 function s(str){
	if(str){
 		return (new Date(str)).getTime()
	}
	return null
 }
		
 $('form').submit(function(e){
	
	e.preventDefault();
	$('.loading').show()
	var filter_date = s($('[name=date]').val())
	$.ajax({	
		url: '/search_tieba',
		data: {	
			isnew: 1,
			kw: $('[name=name]').val(),
			qw: $('[name=kw]').val(),
			only_thread: $('[name=only_thread]')[0].checked ? 1 : 0
		},
		dataType: 'json',
		success: function(data){
			$('.loading').hide()
			$('.result').show()
			var tn = 0;
			var tn1 = 0;
			var rn = 0
			var thread_html = ''
			var reply_html = ''
			$.each(data.data,function(i,el){
				if(!filter_date || (filter_date && s(el.date) > filter_date)){
					if(el.is_thread){	
						tn++
						if(el.title.indexOf('<em') >= 0){	
							tn1++
						}
						thread_html += '<li><em>'+ el.date +'</em>  ' + el.title.replace('href="','href="http://tieba.baidu.com') +'</li>'
					}else{	
						rn++
						reply_html += '<li><em>'+ el.date +'</em>  ' + el.title.replace('href="','href="http://tieba.baidu.com') +'</li>'
					}
				}
			})
			$('.tn').html(tn)
			$('.rn').html(rn)
			$('.tn1').html(tn1)
			$('.thread_list').html(thread_html)
			$('.reply_list').html(reply_html)
		}
	})
	
 })
	
})
</script>

</body>
</html>
